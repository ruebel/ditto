<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for ./src/client/app/blocks/directives/ruTimer.directive.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../../../../prettify.css">
    <link rel="stylesheet" href="../../../../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header low">
    <h1>Code coverage report for <span class="entity">./src/client/app/blocks/directives/ruTimer.directive.js</span></h1>
    <h2>
        Statements: <span class="metric">23.81% <small>(15 / 63)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">0% <small>(0 / 12)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">6.67% <small>(1 / 15)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">23.81% <small>(15 / 63)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../../index.html">All files</a> &#187; <a href="index.html">./src/client/app/blocks/directives/</a> &#187; ruTimer.directive.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158</td><td class="line-coverage"><span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">(function () {
    'use strict';
&nbsp;
    angular
        .module('blocks.directives')
        .directive('ruTimer', ruTimer);
&nbsp;
    ////////////////////////////////////////
&nbsp;
<span class="fstat-no" title="function not covered" >    function ruTimer() {</span>
<span class="cstat-no" title="statement not covered" >        return {</span>
            controller: RuTimerController,
            controllerAs: 'vm',
            replace: true,
            restrict: 'E',
            scope: {
                'startTimer': '=',
                'stopTimer': '=',
                'timer': '='
            },
            templateUrl: getTemplateUrl
        };
&nbsp;
        ////////////////////////////////////////
&nbsp;
        // Gets the template based on the user mode
<span class="fstat-no" title="function not covered" >        function getTemplateUrl(elem, attrs) {</span>
<span class="cstat-no" title="statement not covered" >            var ctrlPage = (attrs.controller === '1' ? 'ruTimerController.html'</span>
                            : 'ruTimerPresentation.html');
<span class="cstat-no" title="statement not covered" >            return 'app/blocks/directives/' + ctrlPage;</span>
        }
    }
&nbsp;
    RuTimerController.$inject = ['$scope', '$timeout', 'common', 'socket'];
&nbsp;
<span class="fstat-no" title="function not covered" >    function RuTimerController($scope, $timeout, common, socket) {</span>
<span class="cstat-no" title="statement not covered" >        var vm = this;</span>
<span class="cstat-no" title="statement not covered" >        var constants = common.constants;</span>
<span class="cstat-no" title="statement not covered" >        var logger = common.logger;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        vm.sendTimerStart = sendTimerStart;</span>
<span class="cstat-no" title="statement not covered" >        vm.sendTimerStop = sendTimerStop;</span>
<span class="cstat-no" title="statement not covered" >        vm.time = {</span>
            end: undefined,
            hours: 0,
            minutes: 1,
            seconds: 0
        };
<span class="cstat-no" title="statement not covered" >        vm.timeMode = moment();</span>
<span class="cstat-no" title="statement not covered" >        vm.timer = {</span>
            run: false,
            end: undefined,
            show: false,
            start: undefined,
            timeLeft: undefined
        };
&nbsp;
<span class="cstat-no" title="statement not covered" >        activate();</span>
&nbsp;
        ////////////////////////////////////////
&nbsp;
<span class="fstat-no" title="function not covered" >        function activate() {</span>
            // Catch start timer
<span class="cstat-no" title="statement not covered" >            $scope.$on(constants.socketPrefix + constants.socketEvents.timerStart,</span>
<span class="fstat-no" title="function not covered" >                       function(event, data) {</span>
<span class="cstat-no" title="statement not covered" >                           logger.info('Timer Started', data.payload);</span>
<span class="cstat-no" title="statement not covered" >                           start(data.payload);</span>
                       });
            // Catch stop timer
<span class="cstat-no" title="statement not covered" >            $scope.$on(constants.socketPrefix + constants.socketEvents.timerStop,</span>
<span class="fstat-no" title="function not covered" >                       function(event, data) {</span>
<span class="cstat-no" title="statement not covered" >                           logger.info('Timer Stopped', data.payload);</span>
<span class="cstat-no" title="statement not covered" >                           stop();</span>
                       });
        }
&nbsp;
        // Gets difference between start and end time in ms
<span class="fstat-no" title="function not covered" >        function getTimeDiff(start, end) {</span>
<span class="cstat-no" title="statement not covered" >            var diff = (end - start) / 1000;</span>
<span class="cstat-no" title="statement not covered" >            return parseTime(diff);</span>
        }
&nbsp;
        // Parse ms into hh:mm:ss clock string
<span class="fstat-no" title="function not covered" >        function parseTime(ms) {</span>
            // Break down the hours, minutes, and seconds
<span class="cstat-no" title="statement not covered" >            var hours = Math.floor(((ms % 31536000) % 86400) / 3600);</span>
<span class="cstat-no" title="statement not covered" >            var mins = Math.floor((((ms % 31536000) % 86400) % 3600) / 60);</span>
<span class="cstat-no" title="statement not covered" >            var secs = Math.min(59, Math.ceil((((ms % 31536000) % 86400) % 3600) % 60));</span>
            // Pad the sections so it looks more like a clock (i.e. 01 instead of 1)
            // Concatenate the hh:mm:ss and return
<span class="cstat-no" title="statement not covered" >            return padTime(hours) + ':' + padTime(mins) + ':' + padTime(secs);</span>
&nbsp;
            ////////////////////////////////////////////
&nbsp;
            // Ensures that each time section is two digits (pads a zero in front if only one)
<span class="fstat-no" title="function not covered" >            function padTime(val) {</span>
<span class="cstat-no" title="statement not covered" >                return val.toString().length &gt; 1 ? val : '0' + val;</span>
            }
        }
&nbsp;
        // Send start timer command
<span class="fstat-no" title="function not covered" >        function sendTimerStart() {</span>
<span class="cstat-no" title="statement not covered" >            var end;</span>
<span class="cstat-no" title="statement not covered" >            if (vm.timeMode === 1) {</span>
<span class="cstat-no" title="statement not covered" >                end = moment().add(vm.time.hours, 'hours')</span>
                    .add(vm.time.minutes, 'minutes')
                    .add(vm.time.seconds, 'seconds');
            } else {
<span class="cstat-no" title="statement not covered" >                end = moment().startOf('day').add(vm.time.end);</span>
<span class="cstat-no" title="statement not covered" >                if (end &lt; moment()) {</span>
<span class="cstat-no" title="statement not covered" >                    logger.warning('End time is less than start time');</span>
<span class="cstat-no" title="statement not covered" >                    return;</span>
                }
            }
<span class="cstat-no" title="statement not covered" >            socket.emit(constants.socketEvents.timerStart, 'test', {end: end});</span>
        }
&nbsp;
        // Send stop timer command
<span class="fstat-no" title="function not covered" >        function sendTimerStop() {</span>
<span class="cstat-no" title="statement not covered" >            socket.emit(constants.socketEvents.timerStop, 'test', '0');</span>
        }
&nbsp;
        // Start the timer
<span class="fstat-no" title="function not covered" >        function start(span) {</span>
<span class="cstat-no" title="statement not covered" >            vm.timer.end = span.end;</span>
<span class="cstat-no" title="statement not covered" >            vm.timer.timeLeft = getTimeDiff(moment(), moment(vm.timer.end));</span>
<span class="cstat-no" title="statement not covered" >            vm.timer.run = true;</span>
<span class="cstat-no" title="statement not covered" >            vm.timer.show = true;</span>
<span class="cstat-no" title="statement not covered" >            doTimer();</span>
        }
&nbsp;
        // Stop the timer
<span class="fstat-no" title="function not covered" >        function stop() {</span>
<span class="cstat-no" title="statement not covered" >            vm.timer.run = false;</span>
        }
&nbsp;
        // Timer running 'thread'
<span class="fstat-no" title="function not covered" >        function doTimer() {</span>
            // Check if we are still running
<span class="cstat-no" title="statement not covered" >            if (!vm.timer.run) {</span>
<span class="cstat-no" title="statement not covered" >                return;</span>
            }
            // Check if time has run out
<span class="cstat-no" title="statement not covered" >            if (moment(vm.timer.end) &lt;= moment()) {</span>
                // Time is up
<span class="cstat-no" title="statement not covered" >                vm.timer.timeLeft = 'That\'s all folks';</span>
<span class="cstat-no" title="statement not covered" >                vm.timer.run = false;</span>
<span class="cstat-no" title="statement not covered" >                return;</span>
            } else {
                // Update time and continue running
<span class="cstat-no" title="statement not covered" >                vm.timer.timeLeft = getTimeDiff(moment(), moment(vm.timer.end));</span>
            }
            // wait and update every 250 ms
<span class="cstat-no" title="statement not covered" >            $timeout(doTimer, 250);</span>
        }
    }
})();
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Jun 19 2015 14:22:18 GMT-0500 (Central Daylight Time)</div>
</div>
<script src="../../../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../../../sorter.js"></script>
</body>
</html>
